<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro de Remessa - My EPI</title>
  <link rel="icon" href="/src/assets/images/Logo head.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
    rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/cadastrar-remessa.css">
</head>

<body>
  <div class="top-navbar position-relative">
    <div class="navbar-title position-absolute start-50 translate-middle-x">
      FUSIONSTEC ENGENHARIA
    </div>
    <button class="btn btn-sm btn-light position-absolute end-0 me-4" onclick="window.location.href='../../index.html'">
      Sair
    </button>
  </div>

   <!-- SIDEBAR VERTICAL -->
  <div class="sidebar" id="sidebar">
    <div class="text-center mb-5">
      <img src="../assets/images/logo.png" alt="Logo" width="120" />
    </div>
    <nav class="nav flex-column">
      <a class="nav-link" href="./dashboard.html">Início</a>
      <a class="nav-link active" href="./estoque.html">Estoque</a>
      <a class="nav-link" href="./epi.html">EPI</a>
      <a class="nav-link" href="funcionario.html">Funcionário</a>
      <a class="nav-link" href="./entregas.html">Entregas de EPI</a>
    </nav>
  </div>

  <div class="main-content">
    <h2 class="mb-4">ESTOQUE</h2>

    <div class="form-container">
      <span class="close-button" onclick="window.location.href='estoque.html'">&times;</span>
      <h4>Cadastro de Remessa</h4>

      <form id="form-cadastro-remessa">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="codigo_lote" class="form-label">Código do Lote</label>
            <input type="text" id="codigo_lote" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="quantidade" class="form-label">Quantidade</label>
            <input type="number" id="quantidade" class="form-control" required min="1">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="id_ca" class="form-label">Certificado de Aprovação (CA)</label>
            <div class="field-group barcode-input-container">
              <select id="id_ca" class="form-select searchable-select" required>
                <option value="" selected disabled>Digite para buscar ou escaneie...</option>
              </select>

              <button type="button" class="barcode-scanner-btn" id="scan-ca-btn" title="Escanear código de barras">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-upc-scan" viewBox="0 0 16 16">
                  <path
                    d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5M.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5M3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0z" />
                </svg>
              </button>
              <div class="loading-indicator">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                  <span class="visually-hidden">Carregando...</span>
                </div>
              </div>
            </div>
            <div class="scanner-instructions">
              Escaneie código de barras ou digite CA (ex: C.A.12345)
            </div>
            <div id="ca-success-message" class="success-message">

            </div>

          </div>
          <div class="col-md-6">
            <label for="id_modelo_epi" class="form-label">Modelo do EPI</label>
            <div class="field-group">
              <select id="id_modelo_epi" class="form-select searchable-select" required>
                <option value="" selected disabled>Digite para buscar...</option>
              </select>
              <div class="loading-indicator">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                  <span class="visually-hidden">Carregando...</span>
                </div>
              </div>
            </div>
            <div id="modelo-success-message" class="success-message">
              ✓ CAs disponíveis carregados
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="id_fornecedor" class="form-label">Fornecedor</label>
            <div class="field-group">
              <select id="id_fornecedor" class="form-select searchable-select" required>
                <option value="" selected disabled>Digite para buscar...</option>
              </select>
              <div class="loading-indicator">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                  <span class="visually-hidden">Carregando...</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <label for="data_entrega" class="form-label">Data de Entrega</label>
            <input type="date" id="data_entrega" class="form-control" required>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="validade_lote" class="form-label">Validade do Lote/EPI</label>
            <input type="date" id="validade_lote" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="nota_fiscal" class="form-label">Nota Fiscal</label>
            <input type="text" id="nota_fiscal" class="form-control" required>
          </div>
        </div>
        <div class="mb-4">
          <label for="observacoes" class="form-label">Observações</label>
          <textarea id="observacoes" class="form-control" rows="3"></textarea>
        </div>
        <div class="text-center">
          <button type="submit" class="btn btn-submit">Adicionar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="barcodeModal" tabindex="-1" aria-labelledby="barcodeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="barcodeModalLabel">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upc-scan"
              viewBox="0 0 16 16">
              <path
                d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5M.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5M3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0z" />
            </svg>
            Scanner de Código de Barras
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-3">
            <p class="mb-3">Aponte o leitor para o código de barras do CA ou digite abaixo:</p>
            <input type="text" id="barcode-input" class="form-control barcode-modal-input" placeholder="C.A.00000"
              autofocus>

            <div class="barcode-status mt-3">
              <div id="barcode-loading" style="display: none;">
                <div class="spinner-border me-2" role="status"></div>
                <span>Processando...</span>
              </div>
              <div id="barcode-success" style="display: none;">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <span>Código lido com sucesso!</span>
              </div>
              <div id="barcode-error" style="display: none;">
                <i class="bi bi-x-octagon-fill text-danger me-2"></i>
                <span>Código não encontrado ou inválido.</span>
              </div>
            </div>
            <small class="form-text text-muted mt-2">
              A leitura é automática após digitar ou escanear.
            </small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script type="module" src="../services/api.js"></script>
  <script type="module" src="../assets/js/cadastrar-remessa.js"></script>
</body>

</html>